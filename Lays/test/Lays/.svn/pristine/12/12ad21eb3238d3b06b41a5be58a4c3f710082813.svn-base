layui.define(["layer","laytpl","upload"],function(V){var m=layui.jquery,f=layui.layer,q=layui.laytpl,J=layui.device(),r={},n=function(){this.v="3.0.4 Pro";m("body").on("click","*[layim-event]",function(a){var b=m(this),c=b.attr("layim-event");k[c]?k[c].call(this,b,a):""})};n.prototype.config=function(a){var b=[];layui.each(Array(5),function(a){b.push(layui.cache.dir+"css/modules/layim/skin/"+(a+1)+".jpg")});a=a||{};a.skin=a.skin||[];layui.each(a.skin,function(a,e){b.unshift(e)});
    a.skin=b;a=m.extend({isfriend:!0,
        isgroup:!0,voice:"default.mp3"},a);if(window.JSON&&window.JSON.parse)return W(a),this};n.prototype.on=function(a,b){"function"===typeof b&&(r[a]?r[a].push(b):r[a]=[b]);return this};n.prototype.cache=function(){return d};n.prototype.thisChat=function(){return p()};n.prototype.chat=function(a){if(window.JSON&&window.JSON.parse)return v(a),this};n.prototype.setChatMin=function(){return x(),this};n.prototype.setChatStatus=function(a){var b=p();if(b)return b.elem.find(".layim-chat-status").html(a),this};
    n.prototype.getMessage=function(a){return X(a),this};n.prototype.notice=function(a){return K(a),this};n.prototype.add=function(a){return y(a),this};n.prototype.setFriendGroup=function(a){return y(a,"setGroup"),this};n.prototype.msgbox=function(a){l.find(".layim-tool-msgbox").find("span").addClass("layui-anim-loop layer-anim-05").html(a);return this};n.prototype.addList=function(a){return Y(a),this};n.prototype.removeList=function(a){return Z(a),this};n.prototype.setFriendStatus=function(a,b){m("#layim-friend"+
        a)["online"===b?"removeClass":"addClass"]("layim-list-gray")};n.prototype.content=function(a){return layui.data.content(a)};var z=function(a){a=a||{};a.item=a.item||"d."+a.type;return["{{# var length = 0; layui.each("+a.item+", function(i, data){ length++; }}",'<li layim-event="chat" data-type="'+a.type+'" data-index="{{ '+(a.index||"i")+' }}" id="layim-'+a.type+'{{ data.id }}" {{ data.status === "offline" ? "class=layim-list-gray" : "" }}><img src="{{ data.avatar }}"><span>{{ data.username||data.groupname||data.name||"\u4f5a\u540d" }}</span><p>{{ data.remark||data.sign||"" }}</p></li>',
            "{{# }); if(length === 0){ }}",'<span class="layim-null">'+({friend:"\u8be5\u5206\u7ec4\u4e0b\u6682\u65e0\u597d\u53cb",group:"\u6682\u65e0\u7fa4\u7ec4",history:"\u6682\u65e0\u5386\u53f2\u4f1a\u8bdd"}[a.type]||"\u6682\u65e0\u6570\u636e")+"</span>","{{# } }}"].join("")},aa=['<div class="layui-layim-main"><div class="layui-layim-info"><div class="layui-layim-user" socket-event="getMyInformation">{{ d.mine.username }}</div><div class="layui-layim-status">{{# if(d.mine.status === "online"){ }}<span class="layui-icon layim-status-online" layim-event="status" lay-type="show">&#xe617;</span>{{# } else if(d.mine.status === "hide") { }}<span class="layui-icon layim-status-hide" layim-event="status" lay-type="show">&#xe60f;</span>{{# } }}<ul class="layui-anim layim-menu-box"><li {{d.mine.status === "online" ? "class=layim-this" : ""}} layim-event="status" lay-type="online"><i class="layui-icon">&#xe618;</i><cite class="layui-icon layim-status-online">&#xe617;</cite>\u5728\u7ebf</li><li {{d.mine.status === "hide" ? "class=layim-this" : ""}} layim-event="status" lay-type="hide"><i class="layui-icon">&#xe618;</i><cite class="layui-icon layim-status-hide">&#xe60f;</cite>\u9690\u8eab</li></ul></div><input class="layui-layim-remark" placeholder="\u7f16\u8f91\u7b7e\u540d" value="{{ d.mine.remark||d.mine.sign||"" }}"></p></div><ul class="layui-unselect layui-layim-tab{{# if(!d.base.isfriend || !d.base.isgroup){ }} layim-tab-two{{# } }}"><li class="layui-icon{{# if(!d.base.isfriend){ }} layim-hide{{# } else { }} layim-this{{# } }}" title="\u8054\u7cfb\u4eba" layim-event="tab" lay-type="friend">&#xe612;</li><li class="layui-icon{{# if(!d.base.isgroup){ }} layim-hide{{# } else if(!d.base.isfriend) { }} layim-this{{# } }}" title="\u7fa4\u7ec4" layim-event="tab" lay-type="group">&#xe613;</li><li class="layui-icon" title="\u5386\u53f2\u4f1a\u8bdd" layim-event="tab" lay-type="history">&#xe611;</li></ul><ul class="layui-unselect layim-tab-content {{# if(d.base.isfriend){ }}layui-show{{# } }} layim-list-friend">{{# layui.each(d.friend, function(index, item){ var spread = d.local["spread"+index]; }}<li><h5 layim-event="spread" lay-type="{{ spread }}" data-groupidx="{{ item.id }}" ><i class="layui-icon">{{# if(spread === "true"){ }}&#xe61a;{{# } else {  }}&#xe602;{{# } }}</i><span>{{ item.groupname||"\u672a\u547d\u540d\u5206\u7ec4"+index }}</span><em>(<cite class="layim-count"> {{ (item.list||[]).length }}</cite>)</em></h5><ul class="layui-layim-list {{# if(spread === "true"){ }} layui-show{{# } }}">',
            z({type:"friend",item:"item.list",index:"index"}),'</ul></li>{{# }); if(d.friend.length === 0){ }}<li><ul class="layui-layim-list layui-show"><li class="layim-null">\u6682\u65e0\u8054\u7cfb\u4eba</li></ul>{{# } }}</ul><ul class="layui-unselect layim-tab-content {{# if(!d.base.isfriend && d.base.isgroup){ }}layui-show{{# } }}"><li><ul class="layui-layim-list layui-show layim-list-group">',z({type:"group"}),'</ul></li></ul><ul class="layui-unselect layim-tab-content  {{# if(!d.base.isfriend && !d.base.isgroup){ }}layui-show{{# } }}"><li><ul class="layui-layim-list layui-show layim-list-history">',
            z({type:"history"}),'</ul></li></ul><ul class="layui-unselect layim-tab-content"><li><ul class="layui-layim-list layui-show" id="layui-layim-search"></ul></li></ul><ul class="layui-unselect layui-layim-tool"><li class="layui-icon layim-tool-search" layim-event="search" title="\u641c\u7d22">&#xe615;</li>{{# if(d.base.msgbox){ }}<li class="layui-icon layim-tool-msgbox" layim-event="msgbox" title="\u6d88\u606f\u76d2\u5b50">&#xe645;<span class="layui-anim"></span></li>{{# } }}{{# if(d.base.find){ }}<li class="layui-icon layim-tool-find" layim-event="find" title="\u67e5\u627e">&#xe608;</li>{{# } }}<li class="layui-icon layim-tool-skin" layim-event="skin" title="\u66f4\u6362\u80cc\u666f">&#xe61b;</li>{{# if(!d.base.copyright){ }}<li class="layui-icon layim-tool-about" layim-event="about" title="\u5173\u4e8e">&#xe60b;</li>{{# } }}</ul><div class="layui-layim-search"><input><label class="layui-icon" layim-event="closeSearch">&#x1007;</label></div></div>'].join(""),
        A=function(a){return 10>a?"0"+(a|0):a};layui.data.date=function(a){a=new Date(a||new Date);return a.getFullYear()+"-"+A(a.getMonth()+1)+"-"+A(a.getDate())+" "+A(a.getHours())+":"+A(a.getMinutes())+":"+A(a.getSeconds())};layui.data.content=function(a){var b=function(a){return new RegExp("\\n*\\["+(a||"")+"(pre|div|p|table|thead|th|tbody|tr|td|ul|li|ol|li|dl|dt|dd|h2|h3|h4|h5)([\\s\\S]*?)\\]\\n*","g")};return a=(a||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,
        "&#39;").replace(/"/g,"&quot;").replace(/@(\S+)(\s+?|$)/g,'@<a href="javascript:;">$1</a>$2').replace(/img\[([^\s]+?)\]/g,function(a){return'<img style="max-width: 200px;" class="layui-layim-photos" src="'+a.replace(/(^img\[)|(\]$)/g,"")+'">'}).replace(/file\([\s\S]+?\)\[[\s\S]*?\]/g,function(a){var b=(a.match(/file\(([\s\S]+?)\)\[/)||[])[1],c=(a.match(/\)\[([\s\S]*?)\]/)||[])[1];return b?'<a class="layui-layim-file" href="'+b+'" download="'+(c||b)+'" target="_blank"><i class="layui-icon">&#xe61e;</i><cite>'+
        (c||b)+"</cite></a>":a}).replace(/audio\[([^\s]+?)\]/g,function(a){return'<div class="layui-unselect layui-layim-audio" layim-event="playAudio" data-src="'+a.replace(/(^audio\[)|(\]$)/g,"")+'"><i class="layui-icon">&#xe652;</i><p>\u97f3\u9891\u6d88\u606f</p></div>'}).replace(/video\[([^\s]+?)\]/g,function(a){return'<div class="layui-unselect layui-layim-video" layim-event="playVideo" data-src="'+a.replace(/(^video\[)|(\]$)/g,"")+'"><i class="layui-icon">&#xe652;</i></div>'}).replace(/a\([\s\S]+?\)\[[\s\S]*?\]/g,
        function(a){var b=(a.match(/a\(([\s\S]+?)\)\[/)||[])[1],c=(a.match(/\)\[([\s\S]*?)\]/)||[])[1];return b?'<a href="'+b+'" target="_blank">'+(c||b)+"</a>":a}).replace(b(),"<$1 $2>").replace(b("/"),"</$1>").replace(/\[([^\s\[\]]{1,7})\]/g,function(a){a=a.replace(/^face/g,"");return'<img alt="'+a+'" title="'+a+'" src="'+G[a]+'">'}).replace(/\n/g,"<br>")};var L=function(a,b,c){a=a||{};return m.ajax({url:a.url,type:a.type||"get",data:a.data,dataType:a.dataType||"json",cache:!1,success:function(a){0==a.code?
            b&&b(a.data||{}):f.msg(a.msg||(c||"Error")+": LAYIM_NOT_GET_DATA",{time:5E3})},error:function(a,b){window.console&&console.log&&console.error("LAYIM_DATE_ERROR\uff1a"+b)}})},d={message:{},chat:[]},W=function(a){var b=a.init||{};mine=b.mine||{};local=layui.data("layim")[mine.id]||{};obj={base:a,local:local,mine:mine,history:local.history||{}};create=function(b){var c=b.mine||{},g=layui.data("layim")[c.id]||{},t={base:a,local:g,mine:c,friend:b.friend||[],group:b.group||[],history:g.history||{}};d=m.extend(d,
        t);ba(q(aa).render(t));(g.close||a.min)&&M();layui.each(r.ready,function(a,b){b&&b(t)})};d=m.extend(d,obj);if(a.brief)return layui.each(r.ready,function(a,b){b&&b(obj)});b.url?L(b,create,"INIT"):create(b)},l,ba=function(a){return f.open({type:1,area:["260px","520px"],skin:"layui-box layui-layim",title:"&#8203;",offset:"rb",id:"layui-layim",shade:!1,anim:2,resize:!1,content:a,success:function(a){l=a;O(a);d.base.right&&a.css("margin-left","-"+d.base.right);B&&f.close(B.attr("times"));var b=[];a=a.find(".layim-list-history");
            a.find("li").each(function(){b.push(m(this).prop("outerHTML"))});0<b.length&&(b.reverse(),a.html(b.join("")));ca();k.sign()},cancel:function(a){M();a=layui.data("layim")[d.mine.id]||{};a.close=!0;layui.data("layim",{key:d.mine.id,value:a});return!1}})},ca=function(){l.on("contextmenu",function(a){a.cancelBubble=!0;return a.returnValue=!1});var a=function(){f.closeAll("tips")};l.find(".layim-list-history").on("contextmenu","li",function(b){b=m(this);var c='<ul data-id="'+b[0].id+'" data-index="'+b.data("index")+
        '"><li layim-event="menuHistory" data-type="one">\u79fb\u9664\u8be5\u4f1a\u8bdd</li><li layim-event="menuHistory" data-type="all">\u6e05\u7a7a\u5168\u90e8\u4f1a\u8bdd\u5217\u8868</li></ul>';b.hasClass("layim-null")||(f.tips(c,this,{tips:1,time:0,anim:5,fixed:!0,skin:"layui-box layui-layim-contextmenu",success:function(a){var b=function(a){u(a)};a.off("mousedown",b).on("mousedown",b)}}),m(document).off("mousedown",a).on("mousedown",a),m(window).off("resize",a).on("resize",a))})},B,M=function(a){B&&
    f.close(B.attr("times"));l&&l.hide();d.mine=d.mine||{};return f.open({type:1,title:!1,id:"layui-layim-close",skin:"layui-box layui-layim-min layui-layim-close",shade:!1,closeBtn:!1,anim:2,offset:"rb",resize:!1,content:'<img src="'+(d.mine.avatar||layui.cache.dir+"css/pc/layim/skin/logo.jpg")+'"><span>'+(a||d.base.title||"\u6211\u7684LayIM")+"</span>",move:"#layui-layim-close img",success:function(a,c){B=a;d.base.right&&a.css("margin-left","-"+d.base.right);a.on("click",function(){f.close(c);l.show();
            var a=layui.data("layim")[d.mine.id]||{};delete a.close;layui.data("layim",{key:d.mine.id,value:a})})}})},h,H,I,v=function(a){a=a||{};var b=m("#layui-layim-chat"),c={data:a,base:d.base,local:d.local};if(!a.id)return f.msg("\u975e\u6cd5\u7528\u6237");if(b[0]){var e=h.find(".layim-chat-list"),g=e.find(".layim-chatlist-"+a.type+a.id),t=h.find(".layui-layer-max").hasClass("layui-layer-maxmin"),b=b.children(".layim-chat-box");"none"===h.css("display")&&h.show();H&&f.close(H.attr("times"));1!==e.find("li").length||
    g[0]||(t||h.css("width",800),e.css({height:h.height()}).show(),b.css("margin-left","200px"));g[0]||(e.append(q('<li class="layim-chatlist-{{ d.data.type }}{{ d.data.id }} layim-this" layim-event="tabChat"><img src="{{ d.data.avatar }}"><span>{{ d.data.name||"\u4f5a\u540d" }}</span>{{# if(!d.base.brief){ }}<i class="layui-icon" layim-event="closeChat">&#x1007;</i>{{# } }}</li>').render(c)),b.append(q('<div class="layim-chat layim-chat-{{d.data.type}}{{d.first ? " layui-show" : ""}}"><div class="layui-unselect layim-chat-title"><div class="layim-chat-other"><img src="{{ d.data.avatar }}"><span class="layim-chat-username" socket-event="{{ d.data.type==="group" ? "groupSet" : "" }}">{{ d.data.name||"\u4f5a\u540d" }} {{d.data.temporary ? "<cite>\u4e34\u65f6\u4f1a\u8bdd</cite>" : ""}} {{# if(d.data.type==="group"){ }} <em class="layim-chat-members"></em><i class="layui-icon">&#xe614;</i> {{# } }}</span><p class={{ d.data.type==="friend"?"layim-chat-status" : "" }}></p></div></div><div class="layim-chat-main"><ul></ul></div><div class="layim-chat-footer"><div class="layui-unselect layim-chat-tool" data-json="{{encodeURIComponent(JSON.stringify(d.data))}}"><span class="layui-icon layim-tool-face" title="\u9009\u62e9\u8868\u60c5" layim-event="face">&#xe60c;</span>{{# if(d.base && d.base.uploadImage){ }}<span class="layui-icon layim-tool-image" title="\u4e0a\u4f20\u56fe\u7247" layim-event="image">&#xe60d;<input type="file" name="file"></span>{{# }; }}{{# if(d.base && d.base.uploadFile){ }}<span class="layui-icon layim-tool-image layim-tool-file" title="\u53d1\u9001\u6587\u4ef6"  layim-event="image"  data-type="file">&#xe61d;<input type="file" id="file" name="file"></span>{{# }; }}{{# if(d.base && d.base.isAudio){ }}<span class="layui-icon layim-tool-audio" title="\u53d1\u9001\u7f51\u7edc\u97f3\u9891" layim-event="media" data-type="audio">&#xe6fc;</span>{{# }; }}{{# if(d.base && d.base.isVideo){ }}<span class="layui-icon layim-tool-video" title="\u53d1\u9001\u7f51\u7edc\u89c6\u9891" layim-event="media" data-type="video">&#xe6ed;</span>{{# }; }}{{# layui.each(d.base.tool, function(index, item){ }}<span class="layui-icon layim-tool-{{item.alias}}" title="{{item.title}}" layim-event="extend" lay-filter="{{ item.alias }}">{{item.icon}}</span>{{# }); }}{{# if(d.base && d.base.chatLog){ }}<span class="layim-tool-log" layim-event="chatLog"><i class="layui-icon">&#xe60e;</i>\u804a\u5929\u8bb0\u5f55</span>{{# }; }}{{# if(d.base && d.base.groupMembers && d.data.type==="group"){ }}<span class="layim-tool-log layim-tool-groupMembers" socket-event="groupMembers"><i class="layui-icon">&#xe602;</i></span>{{# }; }}</div><div class="layim-chat-textarea"><textarea></textarea></div><div class="layim-chat-bottom"><div class="layim-chat-send">{{# if(!d.base.brief){ }}<span class="layim-send-close" layim-event="closeThisChat">\u5173\u95ed</span>{{# } }}<span class="layim-send-btn" layim-event="send">\u53d1\u9001</span><span class="layim-send-set" layim-event="setSend" lay-type="show"><em class="layui-edge"></em></span><ul class="layui-anim layim-menu-box"><li {{d.local.sendHotKey !== "Ctrl+Enter" ? "class=layim-this" : ""}} layim-event="setSend" lay-type="Enter"><i class="layui-icon">&#xe618;</i>\u6309Enter\u952e\u53d1\u9001\u6d88\u606f</li><li {{d.local.sendHotKey === "Ctrl+Enter" ? "class=layim-this" : ""}} layim-event="setSend"  lay-type="Ctrl+Enter"><i class="layui-icon">&#xe618;</i>\u6309Ctrl+Enter\u952e\u53d1\u9001\u6d88\u606f</li></ul></div></div><div class="layim-chat-gag">\u4f60\u5df2\u88ab\u7981\u8a00</div></div></div>').render(c)),
        E());C(e.find(".layim-chatlist-"+a.type+a.id));g[0]||P();Q(a);R();return I}c.first=!0;var N=I=f.open({type:1,area:"600px",skin:"layui-box layui-layim-chat",id:"layui-layim-chat",title:"&#8203;",shade:!1,maxmin:!0,offset:a.offset||"auto",anim:a.anim||0,closeBtn:d.base.brief?!1:1,content:q('<ul class="layui-unselect layim-chat-list"><li class="layim-chatlist-{{ d.data.type }}{{ d.data.id }} layim-this" layim-event="tabChat"><img src="{{ d.data.avatar }}"><span>{{ d.data.name||"\u4f5a\u540d" }}</span>{{# if(!d.base.brief){ }}<i class="layui-icon" layim-event="closeChat">&#x1007;</i>{{# } }}</li></ul><div class="layim-chat-box"><div class="layim-chat layim-chat-{{d.data.type}}{{d.first ? " layui-show" : ""}}"><div class="layui-unselect layim-chat-title"><div class="layim-chat-other"><img src="{{ d.data.avatar }}"><span class="layim-chat-username" socket-event="{{ d.data.type==="group" ? "groupSet" : "" }}">{{ d.data.name||"\u4f5a\u540d" }} {{d.data.temporary ? "<cite>\u4e34\u65f6\u4f1a\u8bdd</cite>" : ""}} {{# if(d.data.type==="group"){ }} <em class="layim-chat-members"></em><i class="layui-icon">&#xe614;</i> {{# } }}</span><p class={{ d.data.type==="friend"?"layim-chat-status" : "" }}></p></div></div><div class="layim-chat-main"><ul></ul></div><div class="layim-chat-footer"><div class="layui-unselect layim-chat-tool" data-json="{{encodeURIComponent(JSON.stringify(d.data))}}"><span class="layui-icon layim-tool-face" title="\u9009\u62e9\u8868\u60c5" layim-event="face">&#xe60c;</span>{{# if(d.base && d.base.uploadImage){ }}<span class="layui-icon layim-tool-image" title="\u4e0a\u4f20\u56fe\u7247" layim-event="image">&#xe60d;<input type="file" name="file"></span>{{# }; }}{{# if(d.base && d.base.uploadFile){ }}<span class="layui-icon layim-tool-image layim-tool-file" title="\u53d1\u9001\u6587\u4ef6"  layim-event="image"  data-type="file">&#xe61d;<input type="file" id="file" name="file"></span>{{# }; }}{{# if(d.base && d.base.isAudio){ }}<span class="layui-icon layim-tool-audio" title="\u53d1\u9001\u7f51\u7edc\u97f3\u9891" layim-event="media" data-type="audio">&#xe6fc;</span>{{# }; }}{{# if(d.base && d.base.isVideo){ }}<span class="layui-icon layim-tool-video" title="\u53d1\u9001\u7f51\u7edc\u89c6\u9891" layim-event="media" data-type="video">&#xe6ed;</span>{{# }; }}{{# layui.each(d.base.tool, function(index, item){ }}<span class="layui-icon layim-tool-{{item.alias}}" title="{{item.title}}" layim-event="extend" lay-filter="{{ item.alias }}">{{item.icon}}</span>{{# }); }}{{# if(d.base && d.base.chatLog){ }}<span class="layim-tool-log" layim-event="chatLog"><i class="layui-icon">&#xe60e;</i>\u804a\u5929\u8bb0\u5f55</span>{{# }; }}{{# if(d.base && d.base.groupMembers && d.data.type==="group"){ }}<span class="layim-tool-log layim-tool-groupMembers" socket-event="groupMembers"><i class="layui-icon">&#xe602;</i></span>{{# }; }}</div><div class="layim-chat-textarea"><textarea></textarea></div><div class="layim-chat-bottom"><div class="layim-chat-send">{{# if(!d.base.brief){ }}<span class="layim-send-close" layim-event="closeThisChat">\u5173\u95ed</span>{{# } }}<span class="layim-send-btn" layim-event="send">\u53d1\u9001</span><span class="layim-send-set" layim-event="setSend" lay-type="show"><em class="layui-edge"></em></span><ul class="layui-anim layim-menu-box"><li {{d.local.sendHotKey !== "Ctrl+Enter" ? "class=layim-this" : ""}} layim-event="setSend" lay-type="Enter"><i class="layui-icon">&#xe618;</i>\u6309Enter\u952e\u53d1\u9001\u6d88\u606f</li><li {{d.local.sendHotKey === "Ctrl+Enter" ? "class=layim-this" : ""}} layim-event="setSend"  lay-type="Ctrl+Enter"><i class="layui-icon">&#xe618;</i>\u6309Ctrl+Enter\u952e\u53d1\u9001\u6d88\u606f</li></ul></div></div><div class="layim-chat-gag">\u4f60\u5df2\u88ab\u7981\u8a00</div></div></div></div>').render(c),
        success:function(b){h=b;b.css({"min-width":"500px","min-height":"420px"});"function"===typeof a.success&&a.success(b);R();O(b);Q(a);P();S();layui.each(r.chatChange,function(a,b){b&&b(p())});b.on("dblclick",".layui-layim-photos",function(){var a=this.src;f.close(v.photosIndex);f.photos({photos:{data:[{alt:"\u5927\u56fe\u6a21\u5f0f",src:a}]},shade:.01,closeBtn:2,anim:0,resize:!1,success:function(a,b){v.photosIndex=b}})})},full:function(a){f.style(N,{width:"100%",height:"100%"},!0);E()},resizing:E,restore:E,
        min:function(){x();return!1},end:function(){f.closeAll("tips");h=null}});return N},E=function(){var a=h.find(".layim-chat-list"),b=h.find(".layim-chat-main"),c=h.height();a.css({height:c});b.css({height:c-20-80-158})},x=function(a){var b=a||p().data,c=layui.layim.cache().base;h&&!a&&h.hide();f.close(x.index);x.index=f.open({type:1,title:!1,skin:"layui-box layui-layim-min",shade:!1,closeBtn:!1,anim:b.anim||2,offset:"b",move:"#layui-layim-min",resize:!1,area:["182px","50px"],content:'<img id="layui-layim-min" src="'+
            b.avatar+'"><span>'+b.name+"</span>",success:function(b,g){a||(H=b);c.minRight&&f.style(g,{left:m(window).width()-b.outerWidth()-parseFloat(c.minRight)});b.find(".layui-layer-content span").on("click",function(){f.close(g);a?layui.each(d.chat,function(a,b){v(b)}):h.show();a&&(d.chat=[],F())});b.find(".layui-layer-content img").on("click",function(a){u(a)})}})},y=function(a,b){a=a||{};f.close(y.index);return a.isAdd?y.index=f.open({type:1,area:"430px",title:{friend:"\u6dfb\u52a0\u597d\u53cb",group:"\u52a0\u5165\u7fa4\u7ec4"}[a.type]||
            "",shade:!1,resize:!1,btn:["\u53d1\u8d77\u5bf9\u8bdd","\u5b8c\u6210"],content:q('<div class="layim-add-box"><div class="layim-add-img"><img class="layui-circle" src="{{ d.data.avatar }}"><p>{{ d.data.name||"" }}</p></div><div class="layim-add-remark">{{# if(d.data.type === "friend" && d.type === "setGroup"){ }}<p>\u9009\u62e9\u5206\u7ec4</p>{{# } if(d.data.type === "friend"){  }}{{# if(d.data.isAdd){  }}<div data-uid="{{d.data.uid}}"><a href="javascript:void(0);" style="color:#4898d5">{{ d.data.name||""  }}{{ d.data.uid||""  }}</a>\u5df2\u7ecf\u662f\u4f60\u7684\u597d\u53cb\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0\u3002</div>{{# }else{ }}<select class="layui-select" id="LAY_layimGroup">{{# layui.each(d.data.group, function(index, item){ }}<option value="{{ item.id }}">{{ item.groupname }}</option>{{# }); }}</select>{{# } }}{{# } }}{{# if(d.data.type === "group" ){ }}{{# if(d.data.isAdd){  }}<div data-uid="{{d.data.uid}}">\u4f60\u5df2\u7ecf\u662f\u8be5\u7fa4\u7684\u6210\u5458\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0\u3002</div>{{# }else if(d.data.approval != "-1"){ }}<p>\u8bf7\u8f93\u5165\u9a8c\u8bc1\u4fe1\u606f</p>{{# }else{ }}<p>\u8be5\u7fa4\u5f00\u542f\u4e86\u514d\u5ba1\u6838\uff0c\u662f\u5426\u7acb\u5373\u52a0\u5165\u3002</p>{{# } }}{{# } if(d.type !== "setGroup" && !d.data.isAdd && d.data.approval != "-1"){ }}<textarea id="LAY_layimRemark" placeholder="\u9a8c\u8bc1\u4fe1\u606f" class="layui-textarea"></textarea>{{# } }}</div></div>').render({data:{name:a.username||
                    a.groupname,isAdd:a.isAdd,uid:a.uid||[],avatar:a.avatar,group:a.group||parent.layui.layim.cache().friend||[],type:a.type},type:b}),yes:function(b,d){f.close(b);v({name:a.username||a.groupname,type:a.type,avatar:a.avatar,id:a.uid})}}):y.index=f.open({type:1,area:"430px",title:{friend:"\u6dfb\u52a0\u597d\u53cb",group:"\u52a0\u5165\u7fa4\u7ec4"}[a.type]||"",shade:!1,resize:!1,btn:b?["\u786e\u8ba4","\u53d6\u6d88"]:"-1"==a.approval?["\u786e\u8ba4","\u53d6\u6d88"]:["\u53d1\u9001\u7533\u8bf7","\u5173\u95ed"],
        content:q('<div class="layim-add-box"><div class="layim-add-img"><img class="layui-circle" src="{{ d.data.avatar }}"><p>{{ d.data.name||"" }}</p></div><div class="layim-add-remark">{{# if(d.data.type === "friend" && d.type === "setGroup"){ }}<p>\u9009\u62e9\u5206\u7ec4</p>{{# } if(d.data.type === "friend"){  }}{{# if(d.data.isAdd){  }}<div data-uid="{{d.data.uid}}"><a href="javascript:void(0);" style="color:#4898d5">{{ d.data.name||""  }}{{ d.data.uid||""  }}</a>\u5df2\u7ecf\u662f\u4f60\u7684\u597d\u53cb\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0\u3002</div>{{# }else{ }}<select class="layui-select" id="LAY_layimGroup">{{# layui.each(d.data.group, function(index, item){ }}<option value="{{ item.id }}">{{ item.groupname }}</option>{{# }); }}</select>{{# } }}{{# } }}{{# if(d.data.type === "group" ){ }}{{# if(d.data.isAdd){  }}<div data-uid="{{d.data.uid}}">\u4f60\u5df2\u7ecf\u662f\u8be5\u7fa4\u7684\u6210\u5458\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0\u3002</div>{{# }else if(d.data.approval != "-1"){ }}<p>\u8bf7\u8f93\u5165\u9a8c\u8bc1\u4fe1\u606f</p>{{# }else{ }}<p>\u8be5\u7fa4\u5f00\u542f\u4e86\u514d\u5ba1\u6838\uff0c\u662f\u5426\u7acb\u5373\u52a0\u5165\u3002</p>{{# } }}{{# } if(d.type !== "setGroup" && !d.data.isAdd && d.data.approval != "-1"){ }}<textarea id="LAY_layimRemark" placeholder="\u9a8c\u8bc1\u4fe1\u606f" class="layui-textarea"></textarea>{{# } }}</div></div>').render({data:{name:a.username||
                    a.groupname,isAdd:a.isAdd,approval:a.approval,uid:a.uid||[],avatar:a.avatar,group:a.group||parent.layui.layim.cache().friend||[],type:a.type},type:b}),yes:function(c,d){var e=d.find("#LAY_layimGroup");d=d.find("#LAY_layimRemark");b?a.submit&&a.submit(e.val(),c):a.submit&&a.submit(e.val(),d.val(),c);f.close(c)}})},C=function(a,b){a=a||m(".layim-chat-list .layim-this");var c=-1===a.index()?0:a.index(),d=h.find(".layim-chat").eq(c),g=h.find(".layui-layer-max").hasClass("layui-layer-maxmin");if(b){a.hasClass("layim-this")&&
    C(0===c?a.next():a.prev());b=h.find(".layim-chat").length;if(1===b)return f.close(I);a.remove();d.remove();2===b&&(h.find(".layim-chat-list").hide(),g||h.css("width","600px"),h.find(".layim-chat-box").css("margin-left",0));return!1}a.addClass("layim-this").siblings().removeClass("layim-this");d.addClass("layui-show").siblings(".layim-chat").removeClass("layui-show");d.find("textarea").focus();layui.each(r.chatChange,function(a,b){b&&b(p())});S()},S=function(){var a=p();d.message[a.data.type+a.data.id]&&
    delete d.message[a.data.type+a.data.id]},p=function(){if(h){var a=m(".layim-chat-list .layim-this").index(),a=h.find(".layim-chat").eq(a),b=JSON.parse(decodeURIComponent(a.find(".layim-chat-tool").data("json")));return{elem:a,data:b,textarea:a.find("textarea")}}},O=function(a){layui.data("layim");var b=d.mine.skin;a.css({"background-image":b?"url("+b+")":d.base.initSkin?"url("+(layui.cache.dir+"css/modules/layim/skin/"+d.base.initSkin)+")":"none"})},Q=function(a){var b=layui.data("layim")[d.mine.id]||
        {},c={},e=b.history||{},g=e[a.type+a.id];if(l){var t=l.find(".layim-list-history");a.historyTime=(new Date).getTime();e[a.type+a.id]=a;b.history=e;layui.data("layim",{key:d.mine.id,value:b});g||(c[a.type+a.id]=a,a=q(z({type:"history",item:"d.data"})).render({data:c}),t.prepend(a),t.find(".layim-null").remove())}},w=function(){var a={username:d.mine?d.mine.username:"\u8bbf\u5ba2",avatar:d.mine?d.mine.avatar:layui.cache.dir+"css/pc/layim/skin/logo.jpg",id:d.mine?d.mine.id:null,mine:!0,timestamp:(new Date).getTime()},
        b=p(),c=b.elem.find(".layim-chat-main ul"),e=d.base.maxLength||3E3;a.content=b.textarea.val();if(""!==a.content.replace(/\s/g,"")){if(a.content.length>e)return f.msg("\u5185\u5bb9\u6700\u957f\u4e0d\u80fd\u8d85\u8fc7"+e+"\u4e2a\u5b57\u7b26");c.append(q('{{# if(d.system){ }}<li class="layim-chat-system"><cite>{{ layui.data.date(d.timestamp) }}</cite><span>{{ layui.data.content(d.content||"&nbsp") }}</span></li>{{# }else{ }}<li {{ d.mine ? "class=layim-chat-mine" : "" }} {{# if(d.cid){ }}data-cid="{{d.cid}}"{{# } }}><div class="layim-chat-user"><img src="{{ d.avatar }}"><cite>{{# if(d.mine){ }}<i>{{ layui.data.date(d.timestamp) }}</i>{{ d.username||"\u4f5a\u540d" }}{{# } else { }}{{ d.username||"\u4f5a\u540d" }}<i>{{ layui.data.date(d.timestamp) }}</i>{{# } }}</cite></div><div class="layim-chat-text timestamp{{ d.timestamp }}" >{{ layui.data.content(d.content||"&nbsp") }}</div></li>{{# } }}').render(a));
        var g={mine:a,to:b.data};T({username:g.mine.username,avatar:g.mine.avatar,id:g.to.id,type:g.to.type,content:g.mine.content,timestamp:g.mine.timestamp,mine:!0});layui.each(r.sendMessage,function(a,b){b&&b(g)})}F();b.textarea.val("").focus()},K=function(a){a=a||{};window.Notification&&("granted"===Notification.permission?new Notification(a.title||"",{body:a.content||"",icon:a.avatar||"http://tp2.sinaimg.cn/5488749285/50/5719808192/1"}):Notification.requestPermission())},U=function(){if(!(J.ie&&9>J.ie)){var a=
        document.createElement("audio");a.src=layui.cache.dir+"css/modules/layim/voice/"+d.base.voice;a.play()}},X=function(a){a=a||{};var b=m(".layim-chatlist-"+a.type+a.id),c,e=b.index();a.timestamp=a.timestamp||(new Date).getTime();a.fromid==d.mine.id&&(a.mine=!0);T(a);JSON.parse(JSON.stringify(a));!a.system&&d.base.voice?U():a.system&&d.base.systemNotice&&U();if(!h&&a.content||-1===e){if(d.message[a.type+a.id])d.message[a.type+a.id].push(a);else if(d.message[a.type+a.id]=[a],"friend"===a.type){var g;
        layui.each(d.friend,function(b,c){layui.each(c.list,function(b,c){if(c.id==a.id)return c.type="friend",c.name=c.username,d.chat.push(c),g=!0});if(g)return!0});g||(a.name=a.username,a.temporary=!0,d.chat.push(a))}else if("group"===a.type){var t;layui.each(d.group,function(b,c){if(c.id==a.id)return c.type="group",c.name=c.groupname,d.chat.push(c),t=!0});t||(a.name=a.groupname,d.chat.push(a))}else a.name=a.name||a.username||a.groupname,d.chat.push(a);"group"===a.type&&layui.each(d.group,function(b,d){if(d.id==
        a.id)return c=d.avatar,!0});if(!a.system)return d.base.notice&&K({title:"\u6765\u81ea "+a.username+" \u7684\u6d88\u606f",content:a.content,avatar:c||a.avatar}),x({name:"\u6536\u5230\u65b0\u6d88\u606f",avatar:c||a.avatar,anim:6})}if(h){var f=p();f.data.type+f.data.id!==a.type+a.id&&(b.addClass("layui-anim layer-anim-06"),setTimeout(function(){b.removeClass("layui-anim layer-anim-06")},300));f=h.find(".layim-chat").eq(e).find(".layim-chat-main ul");a.system?-1!==e&&f.append('<li class="layim-chat-system"><span>'+
        a.content+"</span></li>"):""!==a.content.replace(/\s/g,"")&&f.append(q('{{# if(d.system){ }}<li class="layim-chat-system"><cite>{{ layui.data.date(d.timestamp) }}</cite><span>{{ layui.data.content(d.content||"&nbsp") }}</span></li>{{# }else{ }}<li {{ d.mine ? "class=layim-chat-mine" : "" }} {{# if(d.cid){ }}data-cid="{{d.cid}}"{{# } }}><div class="layim-chat-user"><img src="{{ d.avatar }}"><cite>{{# if(d.mine){ }}<i>{{ layui.data.date(d.timestamp) }}</i>{{ d.username||"\u4f5a\u540d" }}{{# } else { }}{{ d.username||"\u4f5a\u540d" }}<i>{{ layui.data.date(d.timestamp) }}</i>{{# } }}</cite></div><div class="layim-chat-text timestamp{{ d.timestamp }}" >{{ layui.data.content(d.content||"&nbsp") }}</div></li>{{# } }}').render(a));
        F()}},T=function(a){var b=layui.data("layim")[d.mine.id]||{};b.chatlog=b.chatlog||{};var c=b.chatlog[a.type+a.id];if(c){var e;layui.each(c,function(b,c){c.timestamp===a.timestamp&&c.type===a.type&&c.id===a.id&&c.content===a.content&&(e=!0)});e||a.fromid==d.mine.id||c.push(a);20<c.length&&c.shift()}else b.chatlog[a.type+a.id]=[a];layui.data("layim",{key:d.mine.id,value:b})},P=function(){var a=layui.data("layim")[d.mine.id]||{},b=p(),a=a.chatlog||{},c=b.elem.find(".layim-chat-main ul");layui.each(a[b.data.type+
    b.data.id],function(a,b){c.append(q('{{# if(d.system){ }}<li class="layim-chat-system"><cite>{{ layui.data.date(d.timestamp) }}</cite><span>{{ layui.data.content(d.content||"&nbsp") }}</span></li>{{# }else{ }}<li {{ d.mine ? "class=layim-chat-mine" : "" }} {{# if(d.cid){ }}data-cid="{{d.cid}}"{{# } }}><div class="layim-chat-user"><img src="{{ d.avatar }}"><cite>{{# if(d.mine){ }}<i>{{ layui.data.date(d.timestamp) }}</i>{{ d.username||"\u4f5a\u540d" }}{{# } else { }}{{ d.username||"\u4f5a\u540d" }}<i>{{ layui.data.date(d.timestamp) }}</i>{{# } }}</cite></div><div class="layim-chat-text timestamp{{ d.timestamp }}" >{{ layui.data.content(d.content||"&nbsp") }}</div></li>{{# } }}').render(b))});
        F()},Y=function(a){var b={},c,e=l.find(".layim-list-"+a.type);if(d[a.type])if("friend"===a.type)layui.each(d.friend,function(e,g){if(a.groupid==g.id){layui.each(d.friend[e].list,function(b,d){if(d.id==a.id)return c=!0});if(c)return f.msg("\u597d\u53cb ["+(a.username||"")+"] \u5df2\u7ecf\u5b58\u5728\u5217\u8868\u4e2d",{anim:6});d.friend[e].list=d.friend[e].list||[];b[d.friend[e].list.length]=a;a.groupIndex=e;d.friend[e].list.push(a);return!0}});else if("group"===a.type){layui.each(d.group,function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              d){if(d.id==a.id)return c=!0});if(c)return f.msg("\u60a8\u5df2\u662f ["+(a.groupname||"")+"] \u7684\u7fa4\u6210\u5458",{anim:6});b[d.group.length]=a;d.group.push(a)}if(!c){var g=q(z({type:a.type,item:"d.data",index:"friend"===a.type?"data.groupIndex":null})).render({data:b});"friend"===a.type?(e=e.find(">li").eq(a.groupIndex),e.find(".layui-layim-list").append(g),e.find(".layim-count").html(d.friend[a.groupIndex].list.length),e.find(".layim-null")[0]&&e.find(".layim-null").remove()):"group"===a.type&&
        (e.append(g),e.find(".layim-null")[0]&&e.find(".layim-null").remove())}},Z=function(a){var b=l.find(".layim-list-"+a.type);d[a.type]&&("friend"===a.type?layui.each(d.friend,function(c,e){layui.each(e.list,function(e,f){if(a.id==f.id)return f=b.find(">li").eq(c),f.find(".layui-layim-list>li"),f.find(".layui-layim-list>li").eq(e).remove(),d.friend[c].list.splice(e,1),f.find(".layim-count").html(d.friend[c].list.length),0===d.friend[c].list.length&&f.find(".layui-layim-list").html('<li class="layim-null">\u8be5\u5206\u7ec4\u4e0b\u5df2\u65e0\u597d\u53cb\u4e86</li>'),
        !0})}):"group"===a.type&&layui.each(d.group,function(c,e){if(a.id==e.id)return b.find(">li").eq(c).remove(),d.group.splice(c,1),0===d.group.length&&b.html('<li class="layim-null">\u6682\u65e0\u7fa4\u7ec4</li>'),!0}))},F=function(){var a=p().elem.find(".layim-chat-main"),b=a.find("ul"),c=b.find("li").length;if(20<=c){var d=b.find("li").eq(0);b.prev().hasClass("layim-chat-system")||b.before('<div class="layim-chat-system"><span layim-event="chatLog">\u67e5\u770b\u66f4\u591a\u8bb0\u5f55</span></div>');
        20<c&&d.remove()}a.scrollTop(a[0].scrollHeight+1E3);a.find("ul li:last").find("img").load(function(){a.scrollTop(a[0].scrollHeight+1E3)})},R=function(){var a=p().textarea;a.focus();a.off("keydown").on("keydown",function(b){var c=layui.data("layim")[d.mine.id]||{},e=b.keyCode;if("Ctrl+Enter"===c.sendHotKey)b.ctrlKey&&13===e&&w();else if(13===e){if(b.ctrlKey)return a.val(a.val()+"\n");b.shiftKey||(b.preventDefault(),w())}})},G=function(){var a={};layui.each("[):] [:D] [;)] [:-o] [:p] [(H)] [:@] [:s] [:$] [:(] [:'(] [:|] [(a)] [8o|] [8-|] [+o(] [<o)] [|-)] [*-)] [:-#] [:-*] [^o)] [8-)] [(|)] [(u)] [(S)] [(*)] [(#)] [(R)] [({)] [(})] [(k)] [(F)] [(W)] [(D)]".split(" "),
        function(b,c){a[c]=layui.cache.dir+"images/easemob_face/ee_"+(b+1)+".png"});return a}(),u=layui.stope,D=function(a,b){var c;c=a.value;a.focus();document.selection?(c=document.selection.createRange(),document.selection.empty(),c.text=b):(c=[c.substring(0,a.selectionStart),b,c.substr(a.selectionEnd)],a.focus(),a.value=c.join(""))},k={status:function(a,b){var c=function(){a.next().hide().removeClass("layui-anim-upbit")},d=a.attr("lay-type");"show"===d?(u(b),a.next().show().addClass("layui-anim-upbit"),
            m(document).off("click",c).on("click",c)):(b=a.parent().prev(),a.addClass("layim-this").siblings().removeClass("layim-this"),b.html(a.find("cite").html()),b.removeClass("layim-status-"+("online"===d?"hide":"online")).addClass("layim-status-"+d),layui.each(r.online,function(a,b){b&&b(d)}))},sign:function(){var a=l.find(".layui-layim-remark");a.on("change",function(){var a=this.value;layui.each(r.sign,function(b,d){d&&d(a)})});a.on("keyup",function(a){13===a.keyCode&&this.blur()})},tab:function(a){var b,
            c=l.find(".layui-layim-tab>li");"number"===typeof a?(b=a,a=c.eq(b)):b=a.index();2<b?c.removeClass("layim-this"):(k.tab.index=b,a.addClass("layim-this").siblings().removeClass("layim-this"));l.find(".layim-tab-content").eq(b).addClass("layui-show").siblings(".layim-tab-content").removeClass("layui-show")},spread:function(a){var b=a.attr("lay-type"),c="true"===b?"false":"true",e=layui.data("layim")[d.mine.id]||{};a.next()["true"===b?"removeClass":"addClass"]("layui-show");e["spread"+a.parent().index()]=
            c;layui.data("layim",{key:d.mine.id,value:e});a.attr("lay-type",c);a.find(".layui-icon").html("true"===c?"&#xe61a;":"&#xe602;")},search:function(a){a=l.find(".layui-layim-search");var b=l.find("#layui-layim-search"),c=a.find("input"),e=function(a){var e=c.val().replace(/\s/);if(""===e)k.tab(k.tab.index|0);else{a=[];for(var g=d.friend||[],f=d.group||[],m="",h=0;h<g.length;h++)for(var l=0;l<(g[h].list||[]).length;l++)if(-1!==g[h].list[l].username.indexOf(e)||-1!==g[h].list[l].id.indexOf(e))g[h].list[l].type=
            "friend",g[h].list[l].index=h,g[h].list[l].list=l,a.push(g[h].list[l]);for(g=0;g<f.length;g++)if(-1!==f[g].groupname.indexOf(e)||-1!==f[g].id.indexOf(e))f[g].type="group",f[g].index=g,f[g].list=g,a.push(f[g]);if(0<a.length)for(e=0;e<a.length;e++)m+='<li layim-event="chat" data-type="'+a[e].type+'" data-index="'+a[e].index+'" data-list="'+a[e].list+'"><img src="'+a[e].avatar+'"><span>'+(a[e].username||a[e].groupname||"\u4f5a\u540d")+"</span><p>"+(a[e].remark||a[e].sign||"")+"</p></li>";else m='<li class="layim-null">\u65e0\u641c\u7d22\u7ed3\u679c</li>';
            b.html(m);k.tab(3)}};!d.base.isfriend&&d.base.isgroup?k.tab.index=1:d.base.isfriend||d.base.isgroup||(k.tab.index=2);a.show();c.focus();c.off("keyup",e).on("keyup",e)},closeSearch:function(a){a.parent().hide();k.tab(k.tab.index|0);l.find(".layui-layim-search").find("input").val("")},msgbox:function(){var a=l.find(".layim-tool-msgbox");f.close(k.msgbox.index);a.find("span").removeClass("layui-anim-loop layer-anim-05").html("");return k.msgbox.index=f.open({type:2,title:"\u6d88\u606f\u76d2\u5b50",shade:!1,
            maxmin:!0,area:["600px","520px"],skin:"layui-box layui-layer-border",resize:!1,content:d.base.msgbox})},find:function(){f.close(k.find.index);return k.find.index=f.open({type:2,title:"\u67e5\u627e",shade:!1,maxmin:!0,area:["1000px","640px"],skin:"layui-box layui-layer-border",resize:!1,content:d.base.find})},skin:function(){f.open({type:1,title:"\u66f4\u6362\u80cc\u666f",shade:!1,area:"300px",skin:"layui-box layui-layer-border",id:"layui-layim-skin",zIndex:66666666,resize:!1,content:q('<ul class="layui-layim-skin">{{# layui.each(d.skin, function(index, item){ }}<li><img layim-event="setSkin" src="{{ item }}"></li>{{# }); }}<li layim-event="setSkin"><cite>\u9ed8\u8ba4</cite></li><li layim-event="setSkinByUser"><input type="file" name="file" style="opacity: 0.01;width: 86px;height: 60px;display: block;"><cite style="margin-top: -60px;display: block;">\u81ea\u5b9a\u4e49</cite></li></ul>').render({skin:d.base.skin})})},
        about:function(){
            $.get(g_site_url+'index.php?chat/user/ajaxpoplogin&action=signout', {

            });
        },setSkin:function(a){var b=a.attr("src"),c=layui.data("layim")[d.mine.id]||{};(c.skin=b)||delete c.skin;layui.data("layim",{key:d.mine.id,value:c});"setSkin"==a.attr("layim-event")&&m.post((d.base.systemSkin||{}).url,{type:b},function(a){console.log("\u7cfb\u7edf\u76ae\u80a4")});try{l.css({"background-image":b?
                "url("+b+")":"none"}),h.css({"background-image":b?"url("+b+")":"none"})}catch(e){}layui.each(r.setSkin,function(a,c){a=(b||"").replace(layui.cache.dir+"css/modules/layim/skin/","");c&&c(a,b)})},chat:function(a){var b=layui.data("layim")[d.mine.id]||{},c=a.data("type"),e=a.data("index");a=a.attr("data-list")||a.index();var g={};"friend"===c?g=d[c][e].list[a]:"group"===c?g=d[c][a]:"history"===c&&(g=(b.history||{})[e]||{});g.name=g.name||g.username||g.groupname;"history"!==c&&(g.type=c);v(g)},tabChat:function(a){C(a)},
        closeChat:function(a,b){C(a.parent(),1);u(b)},closeThisChat:function(){C(null,1)},groupMembers:function(a,b){var c=a.find(".layui-icon"),e=function(){c.html("&#xe61a;");a.data("down",null);f.close(k.groupMembers.index)};b=function(a){u(a)};a.data("down")?e():(c.html("&#xe619;"),a.data("down",!0),k.groupMembers.index=f.tips('<ul class="layim-members-list"></ul>',a,{tips:3,time:0,anim:5,fixed:!0,skin:"layui-box layui-layim-members",success:function(b){var c=d.base.members||{},g=p(),f=b.find(".layim-members-list"),
                k="",l={},n=h.find(".layui-layer-max").hasClass("layui-layer-maxmin"),q="none"===h.find(".layim-chat-list").css("display");n&&f.css({width:m(window).width()-22-(q||200)});c.data=m.extend(c.data,{id:g.data.id});L(c,function(b){layui.each(b.list,function(a,b){k+='<li data-uid="'+b.id+'"><a href="javascript:;"><img src="'+b.avatar+'"><cite>'+b.username+"</cite></a></li>";l[b.id]=b});f.html(k);a.find(".layim-chat-members").html(b.members||(b.list||[]).length+"\u4eba");f.find("li").on("click",function(){var a=
                m(this).data("uid"),a=l[a];v({name:a.username,type:"friend",avatar:a.avatar,id:a.id});e()});layui.each(r.members,function(a,c){c&&c(b)})});b.on("mousedown",function(a){u(a)})}}),m(document).off("mousedown",e).on("mousedown",e),m(window).off("resize",e).on("resize",e),a.off("mousedown",b).on("mousedown",b))},send:function(){w()},setSend:function(a,b){var c=k.setSend.box=a.siblings(".layim-menu-box"),e=a.attr("lay-type");"show"===e?(u(b),c.show().addClass("layui-anim-upbit"),m(document).off("click",
            k.setSendHide).on("click",k.setSendHide)):(a.addClass("layim-this").siblings().removeClass("layim-this"),c=layui.data("layim")[d.mine.id]||{},c.sendHotKey=e,layui.data("layim",{key:d.mine.id,value:c}),k.setSendHide(b,a.parent()))},setSendHide:function(a,b){(b||k.setSend.box).hide().removeClass("layui-anim-upbit")},face:function(a,b){var c="",d=p(),g;for(g in G)c+='<li title="'+g+'"><img src="'+G[g]+'"></li>';k.face.index=f.tips('<ul class="layui-clear layim-face-list">'+c+"</ul>",a,{tips:1,time:0,
            fixed:!0,skin:"layui-box layui-layim-face",success:function(a){a.find(".layim-face-list>li").on("mousedown",function(a){u(a)}).on("click",function(){D(d.textarea[0],this.title+" ");f.close(k.face.index)})}});m(document).off("mousedown",k.faceHide).on("mousedown",k.faceHide);m(window).off("resize",k.faceHide).on("resize",k.faceHide);u(b)},faceHide:function(){f.close(k.face.index)},image:function(a){var b=a.data("type")||"images",c=p(),e=d.base[{images:"uploadImage",file:"uploadFile"}[b]]||{};layui.upload.render({url:e.url||
                "",method:e.type||"post",elem:a.find("input")[0],accept:b,done:function(a){0==a.code?(a.data=a.data||{},"images"===b?D(c.textarea[0],"img["+(a.data.uri+"/"+a.data.entities[0].uuid||"")+"]"):"file"===b&&D(c.textarea[0],"file("+(a.data.src||"")+")["+(a.data.name||"\u4e0b\u8f7d\u6587\u4ef6")+"]"),w()):f.msg(a.msg||"\u4e0a\u4f20\u5931\u8d25")}})},setSkinByUser:function(a){var b=d.base.uploadSkin||{};layui.data("layim");layui.upload.render({url:b.url||"",method:b.type||"post",elem:a.find("input")[0],accept:"uploadSkin",
            before:function(){},done:function(b){0==b.code?(b.data=b.data||{},a.attr("src",b.data.src),k.setSkin(a),f.close(f.index)):f.msg(b.msg||"\u4e0a\u4f20\u5931\u8d25")}})},media:function(a){var b=a.data("type"),c=p();f.prompt({title:"\u8bf7\u8f93\u5165\u7f51\u7edc"+{audio:"\u97f3\u9891",video:"\u89c6\u9891"}[b]+"\u5730\u5740",shade:!1,offset:[a.offset().top-m(window).scrollTop()-158+"px",a.offset().left+"px"]},function(a,d){D(c.textarea[0],b+"["+a+"]");w();f.close(d)})},extend:function(a){var b=a.attr("lay-filter"),
            c=p();layui.each(r["tool("+b+")"],function(b,d){d&&d.call(a,function(a){D(c.textarea[0],a)},w,c)})},playAudio:function(a){var b=a.data("audio"),c=b||document.createElement("audio"),d=function(){c.pause();a.removeAttr("status");a.find("i").html("&#xe652;")};if(!c.play)return f.msg("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301audio");a.attr("status")?d():(b||(c.src=a.data("src")),c.play(),a.attr("status","pause"),a.data("audio",c),a.find("i").html("&#xe651;"),c.onended=function(){d()})},playVideo:function(a){a=
            a.data("src");if(!document.createElement("video").play)return f.msg("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301video");f.close(k.playVideo.index);k.playVideo.index=f.open({type:1,title:"\u64ad\u653e\u89c6\u9891",area:["460px","300px"],maxmin:!0,shade:!1,content:'<div style="background-color: #000; height: 100%;"><video style="position: absolute; width: 100%; height: 100%;" src="'+a+'" loop="loop" autoplay="autoplay"></video></div>'})},chatLog:function(a){a=p();if(!d.base.chatLog)return f.msg("\u672a\u5f00\u542f\u66f4\u591a\u804a\u5929\u8bb0\u5f55");
            f.close(k.chatLog.index);return k.chatLog.index=f.open({type:2,maxmin:!0,title:"\u4e0e "+a.data.name+" \u7684\u804a\u5929\u8bb0\u5f55",area:["450px","100%"],shade:!1,offset:"rb",skin:"layui-box",anim:2,id:"layui-layim-chatlog",content:d.base.chatLog+"?id="+a.data.id+"&type="+a.data.type})},menuHistory:function(a,b){b=layui.data("layim")[d.mine.id]||{};var c=a.parent(),e=a.data("type");a=l.find(".layim-list-history");"one"===e?(e=b.history,delete e[c.data("index")],b.history=e,layui.data("layim",{key:d.mine.id,
            value:b}),m("#"+c.data("id")).remove(),0===a.find("li").length&&a.html('<li class="layim-null">\u6682\u65e0\u5386\u53f2\u4f1a\u8bdd</li>')):"all"===e&&(delete b.history,layui.data("layim",{key:d.mine.id,value:b}),a.html('<li class="layim-null">\u6682\u65e0\u5386\u53f2\u4f1a\u8bdd</li>'));f.closeAll("tips")}};V("layim",new n)}).addcss("modules/layim/layim.css?v=3.04Pro","skinlayimcss");